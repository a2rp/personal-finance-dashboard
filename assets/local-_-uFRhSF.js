const u="pfd.v1",a=()=>new Date().toISOString(),b=()=>new Date().toISOString().slice(0,10),s=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),f=e=>(typeof e=="string"?e:new Date(e).toISOString()).slice(0,7),m=(e,n)=>f(e)===n;function g(){return{settings:{currency:"INR",locale:"en-IN",createdAt:a(),updatedAt:a()},accounts:[{id:s(),name:"Cash",type:"cash",openingBalance:0,archived:!1,createdAt:a(),updatedAt:a()}],envelopes:[{id:s(),name:"Groceries",color:"#7c9cff",carryover:!0,budget:1e4,createdAt:a(),updatedAt:a()},{id:s(),name:"Rent",color:"#ffb86b",carryover:!1,budget:15e3,createdAt:a(),updatedAt:a()}],transactions:[]}}function d(){try{const e=localStorage.getItem(u);if(!e){const n=g();return localStorage.setItem(u,JSON.stringify(n)),n}return JSON.parse(e)}catch{const e=g();return localStorage.setItem(u,JSON.stringify(e)),e}}function i(e){localStorage.setItem(u,JSON.stringify(e))}function I(){return d()}function A(e){return i(e),e}function N(e){var r;const n=d(),o={id:s(),date:(e==null?void 0:e.date)||b(),amount:Number(e==null?void 0:e.amount)||0,type:(e==null?void 0:e.type)||(Number(e==null?void 0:e.amount)>=0?"income":"expense"),accountId:(e==null?void 0:e.accountId)||((r=n.accounts[0])==null?void 0:r.id)||null,envelopeId:(e==null?void 0:e.envelopeId)||null,note:(e==null?void 0:e.note)||"",createdAt:a(),updatedAt:a()};return n.transactions.push(o),i(n),o}function v(e={}){const n=d(),o={id:s(),name:e.name||"Account",type:e.type||"cash",openingBalance:Number(e.openingBalance)||0,archived:!1,createdAt:a(),updatedAt:a()};return n.accounts.push(o),i(n),o}function w(e=f(new Date)){const n=d(),o=n.transactions.filter(t=>m(t.date,e)&&(t.type==="income"||t.amount>0)).reduce((t,c)=>t+Math.abs(Number(c.amount)||0),0),r=n.transactions.filter(t=>m(t.date,e)&&(t.type==="expense"||t.amount<0)).reduce((t,c)=>t+Math.abs(Number(c.amount)||0),0),y=n.accounts.reduce((t,c)=>t+(Number(c.openingBalance)||0),0)+(o-r),p=n.envelopes.reduce((t,c)=>t+(Number(c.budget)||0),0),l=p-r,S=Math.max(0,-l);return{income:o,expense:r,balance:y,totalBudget:p,remainingBudget:l,overspent:S}}export{N as a,v as b,I as g,w as k,A as s};
