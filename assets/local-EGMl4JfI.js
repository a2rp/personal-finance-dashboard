const d="pfd.v1",o=()=>new Date().toISOString(),S=()=>new Date().toISOString().slice(0,10),s=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),f=e=>(typeof e=="string"?e:new Date(e).toISOString()).slice(0,7),m=(e,n)=>f(e)===n;function g(){return{settings:{currency:"INR",locale:"en-IN",createdAt:o(),updatedAt:o()},accounts:[{id:s(),name:"Cash",type:"cash",openingBalance:0,archived:!1,createdAt:o(),updatedAt:o()}],envelopes:[{id:s(),name:"Groceries",color:"#7c9cff",carryover:!0,budget:1e4,createdAt:o(),updatedAt:o()},{id:s(),name:"Rent",color:"#ffb86b",carryover:!1,budget:15e3,createdAt:o(),updatedAt:o()}],transactions:[]}}function u(){try{const e=localStorage.getItem(d);if(!e){const n=g();return localStorage.setItem(d,JSON.stringify(n)),n}return JSON.parse(e)}catch{const e=g();return localStorage.setItem(d,JSON.stringify(e)),e}}function i(e){localStorage.setItem(d,JSON.stringify(e))}function v(){return u()}function A(e){return i(e),e}function I(e){var r;const n=u(),a={id:s(),date:(e==null?void 0:e.date)||S(),amount:Number(e==null?void 0:e.amount)||0,type:(e==null?void 0:e.type)||(Number(e==null?void 0:e.amount)>=0?"income":"expense"),accountId:(e==null?void 0:e.accountId)||((r=n.accounts[0])==null?void 0:r.id)||null,envelopeId:(e==null?void 0:e.envelopeId)||null,note:(e==null?void 0:e.note)||"",createdAt:o(),updatedAt:o()};return n.transactions.push(a),i(n),a}function N(e={}){const n=u(),a={id:s(),name:e.name||"Account",type:e.type||"cash",openingBalance:Number(e.openingBalance)||0,archived:!1,createdAt:o(),updatedAt:o()};return n.accounts.push(a),i(n),a}function w(e={}){const n=u(),a={id:s(),name:e.name||"Category",color:e.color||"#9aa0a6",carryover:!!e.carryover,budget:Number(e.budget)||0,createdAt:o(),updatedAt:o()};return n.envelopes.push(a),i(n),a}function O(e=f(new Date)){const n=u(),a=n.transactions.filter(t=>m(t.date,e)&&(t.type==="income"||t.amount>0)).reduce((t,c)=>t+Math.abs(Number(c.amount)||0),0),r=n.transactions.filter(t=>m(t.date,e)&&(t.type==="expense"||t.amount<0)).reduce((t,c)=>t+Math.abs(Number(c.amount)||0),0),y=n.accounts.reduce((t,c)=>t+(Number(c.openingBalance)||0),0)+(a-r),p=n.envelopes.reduce((t,c)=>t+(Number(c.budget)||0),0),l=p-r,b=Math.max(0,-l);return{income:a,expense:r,balance:y,totalBudget:p,remainingBudget:l,overspent:b}}export{I as a,N as b,w as c,v as g,O as k,A as s};
